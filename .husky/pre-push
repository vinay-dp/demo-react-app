#!/bin/sh

# Get current branch
current_branch=$(git branch --show-current)

# Skip if pushing to main
if [ "$current_branch" = "main" ]; then
  echo "âœ… Pushing to main - skipping pre-push checks"
  exit 0
fi

echo "ğŸ” Running pre-push checks for branch: $current_branch"
echo ""

# Run ESLint on ui-library
echo "ğŸ“ Running ESLint..."
cd ui-library
npm run lint
lint_result=$?
cd ..

if [ $lint_result -ne 0 ]; then
  echo ""
  echo "âŒ ESLint errors found! Please fix them before pushing."
  echo "   Run 'cd ui-library && npm run lint' to see errors"
  exit 1
fi

echo "âœ… ESLint passed"
echo ""

# Prompt for version update
echo "ğŸ“¦ Checking version..."
node .husky/version-prompt.js
version_result=$?

if [ $version_result -ne 0 ]; then
  echo "âŒ Version update failed or cancelled"
  exit 1
fi

echo ""
echo "âœ… All pre-push checks passed!"
exit 0

