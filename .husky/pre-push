#!/bin/sh

# Get current branch
current_branch=$(git branch --show-current)

# Block direct pushes to main - require PR workflow
if [ "$current_branch" = "main" ]; then
  echo ""
  echo "âŒ Direct pushes to 'main' branch are not allowed!"
  echo ""
  echo "Please use the Pull Request workflow:"
  echo "  1. Create a feature/dev branch"
  echo "  2. Make your changes and commit"
  echo "  3. Push to your branch"
  echo "  4. Create a Pull Request to merge into main"
  echo ""
  echo "Current branch: main"
  echo "To push to a different branch: git checkout -b your-branch-name"
  echo ""
  exit 1
fi

echo "ğŸ” Running pre-push checks for branch: $current_branch"
echo ""

# Run ESLint on ui-library
echo "ğŸ“ Running ESLint..."
cd ui-library
npm run lint
lint_result=$?
cd ..

if [ $lint_result -ne 0 ]; then
  echo ""
  echo "âŒ ESLint errors found! Please fix them before pushing."
  echo "   Run 'cd ui-library && npm run lint' to see errors"
  exit 1
fi

echo "âœ… ESLint passed"
echo ""

# Prompt for version update
echo "ğŸ“¦ Checking version..."
node .husky/version-prompt.js
version_result=$?

if [ $version_result -ne 0 ]; then
  echo "âŒ Version update failed or cancelled"
  exit 1
fi

echo ""
echo "âœ… All pre-push checks passed!"
exit 0

