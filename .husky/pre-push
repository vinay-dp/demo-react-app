#!/bin/sh

# Get current branch
current_branch=$(git branch --show-current)

# Block direct pushes to main - require PR workflow
if [ "$current_branch" = "main" ]; then
  echo ""
  echo "‚ùå Direct pushes to 'main' branch are not allowed!"
  echo ""
  echo "Please use the Pull Request workflow:"
  echo "  1. Create a feature/dev branch"
  echo "  2. Make your changes and commit"
  echo "  3. Push to your branch"
  echo "  4. Create a Pull Request to merge into main"
  echo ""
  echo "Current branch: main"
  echo "To push to a different branch: git checkout -b your-branch-name"
  echo ""
  exit 1
fi

echo "üîç Running pre-push checks for branch: $current_branch"
echo ""

# Run ESLint on ui-library
echo "üìù Running ESLint..."
cd ui-library
npm run lint
lint_result=$?
cd ..

if [ $lint_result -ne 0 ]; then
  echo ""
  echo "‚ùå ESLint errors found! Please fix them before pushing."
  echo "   Run 'cd ui-library && npm run lint' to see errors"
  exit 1
fi

echo "‚úÖ ESLint passed"
echo ""

# Version update is now optional - skip for now
# You can manually update version with: cd ui-library && npm version patch/minor/major
echo "‚ÑπÔ∏è  Version management:"
echo "   To update version manually: cd ui-library && npm version [patch|minor|major]"
echo ""

echo "‚úÖ All pre-push checks passed!"
exit 0
